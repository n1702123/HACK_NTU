<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>台北綠健俠</title>

    <!-- Bootstrap Core CSS -->
    <link href="https://blackrockdigital.github.io/startbootstrap-round-about/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="https://blackrockdigital.github.io/startbootstrap-round-about/css/round-about.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <style>
 
		.myimg{ 
			height: 100px;
			width: 100% 
		}
		 
		.mytext {
			left: 0;
			position:absolute;
			text-align:center;
			color: black;
			top:50px;
			
			width: 100%
		}
		
		
		#myRight{
		    background-image: -webkit-linear-gradient(left,rgba(0,0,0,.0001) 0,rgba(0, 0, 0, 0) 100%);
			background-image: linear-gradient(to right,rgba(0,0,0,.0001) 0,rgba(0, 0, 0, 0) 100%);
		
		}
		
    </style>

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <h1 style="color:white"><a style="color:white" href="./index.html"><b>台北綠健俠</b></a></h1>

            </div>

        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <!-- Introduction Row -->
        <div class="row">
            <div class="col-lg-12">

                <div class="col-lg-4">
                    <h3><span><b>公車 可服務面積</b></span> </h3>
                    <h5><span id="busAreaText"></span> </h5>
                    
                    <div id="busMap" style="width:350px;height:300px"></div>
                </div>

                <div class="col-lg-4">
                    <h3><span><b>MRT 可服務面積</b></span> </h3>
                    <h5><span id="mrtAreaText"></span> </h5>
                    <div id="mrtMap" style="width:350px;height:300px"></div>
                </div>

                <div class="col-lg-4">
                    <h3><span><b>Ubike 可服務面積</b></span> </h3>
                    <h5><span id="ubikeAreaText"></span> </h5>
                    <div id="ubikeMap" style="width:350px;height:300px"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="col-lg-4">
                    <h3><span><b>公車彎繞程度</b></span> </h3>
                    <h5><span id="busCurveText"></span> </h5>
                    <h5><span>彎繞程度指標=公車路線行駛距離/實際路線最短距離</span> </h5>
                    <div id="busCurveMap" style="width:350px;height:300px"></div>
                </div>
                 
            </div>
        </div>
        <hr>
		
		<!-- <h2>Carousel Example</h2>  --> 
		
		<div class="row">
			 
            <div class="col-lg-10"  id="viewAA" >
			
				<div id="myCarousel" class="carousel slide" data-ride="carousel"  style="height:500px;"  >
	   
					<!--  
					<ol class="carousel-indicators">
					  <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
					  <li data-target="#myCarousel" data-slide-to="1"></li>
					  <li data-target="#myCarousel" data-slide-to="2"></li>
					</ol> -->

					<!-- Wrapper for slides -->
					<div class="carousel-inner" id="helloText">
					
						
						 
						 
				  
					</div>

					<!-- Left and right controls -->
					<a class="left carousel-control" href="#myCarousel" data-slide="prev"  id="myRight"   >
					  <span class="glyphicon glyphicon-chevron-left"></span>
					  <span class="sr-only">Previous</span>
					</a>
					<a class="right carousel-control" href="#myCarousel" data-slide="next"  id="myRight"  >
					  <span class="glyphicon glyphicon-chevron-right"></span>
					  <span class="sr-only">Next</span>
					</a>
				</div>
				
			</div> 
			
			<div class="col-lg-2">
				
				<div class="row"> 111</div>
				 
				<div class="row"> 222</div>
				
				<div class="row"> 333</div>
			
			</div>
		</div>
		
		
		

 
		<!-- Footer -->
		<footer>
			<div class="row">
				<div class="col-lg-12">
					 
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
		</footer>


    </div>
    <!-- /.container -->
	
	
	<div class="container">
	  
	</div>
	
	
	<hr>

	




    <!-- jQuery -->
    <script src="https://blackrockdigital.github.io/startbootstrap-round-about/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://blackrockdigital.github.io/startbootstrap-round-about/js/bootstrap.min.js"></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
	
	
	
	<script>
	
	 
		var myObj =  
		[
			[ 
			
				"106年農曆春節假期共計6日，為讓民眾迅速返鄉過節，本市公共運輸處(以下簡稱公運處)將針對臺北轉運站部分路線實施站外下客措施，<br/>於小年夜（1月26日）15時至22時、除夕（1月27日）9時至15時及春節假期末2日（1月31日及2月1日）10時至22時，除現有站外下客路線外，另於轉運站週邊規劃2處下客地點(臺北車站東三門及西三門)；詳細位置圖如附件。<br/>"+
				"1.和欣及阿羅哈客運於臺北車站西三門臨時停靠區(如圖示A)停靠下客。<br/>"+
				"2.國光客運臺中以南路線於臺北車站東三門(如圖示B)停靠下客。<br/>"+
				"公運處特別提醒，搭乘和欣、阿羅哈及國光客運之民眾事先告知接送親友，上述時段接送地點位在臺北轉運站外，避免因改變下客地點而影響返家行程；另統聯、豐原客運維持於站內下客，現有常態站外下客路線(如圖示C、D、E)亦維持不變。<br/>"+
				"公運處預估假期前後(1月26日、27日及2月1日)為臺北轉運站輸運高峰，臺北車站週邊於忠孝西路、中山北路、重慶北路及南京西路等範圍內交通量將進入最高峰，故提醒民眾儘量避開該區域內道路，尤其南京西路、市民大道等路段，請改走替代道路，或使用大眾運輸工具前往。春節假期臺北轉運站實施站外下客措施。<br/>"
			  
			, "AA文本2" , "AA文本3"], 
			
			[ "BB文本1" , "BB文本2" , "BB文本3"], 
			[ "CC文本1" , "CC文本2" , "CC文本3"], 
		
		];
		
		
		
	





	
	
	</script>

	
    <!--計算面積使用-->
    <script>
      
        var state = {
            lat: null,
            lng: null,
            walkDistance: 600,
            tripTime: 30,
            weekType: 6,
            transitType: 'YMB',
            startTime: '0800',
			no : null,
			type : null
        }
        var lat;
        var lng;
		
 

        var urlParams;
        (window.onpopstate = function () {
            var match,
                pl = /\+/g,  // Regex for replacing addition symbol with a space
                search = /([^&=]+)=?([^&]*)/g,
                decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
                query = window.location.search.substring(1);

            urlParams = {};
            while (match = search.exec(query))
                urlParams[decode(match[1])] = decode(match[2]);

            console.log("urlParams :", urlParams);  // 取得參數
            state.lat = parseFloat(urlParams.lat);
            state.lng = parseFloat(urlParams.lng);
			
			state.type = urlParams.type;
			state.no = urlParams.no;
			
        })();
		
		
		if(state.type!=1){
		
			var no = state.no;
		
			console.log("no : " + no );
			 
			var myTest = myObj[no];
			
			var tempString = "";
			
			for(var i = 0 ; i < myTest.length ; i++){
				
				if(i == 0){
					tempString = tempString + "<div class='item active'>";
				}else{
					tempString = tempString + "<div class='item'>";
				} 
				tempString = tempString + "<img  class='myimg'  src='111.jpg'    style='height:500px;'> ";
				tempString = tempString + "<div  class='mytext' >"+ myTest[i] +"</div> ";
				tempString = tempString + "</div>"; 
			}
			
			
			$("#helloText").html(tempString);
			 
		
		}else{
		
			$("#viewAA").remove("#myCarousel"); 
			$("#viewAA").empty();
			$("#viewAA").hide();
		
		}
		
		
	
		
		/////////////
 
 
        var busMap;
        var mrtMap;
        var ubikeMap;
        var busCurveMap;//彎繞程度

        var busLayer;
        var mrtLayer;
        var ubikeLayer;
        var busCurveLayer;

        var busArea;
        var mrtArea;
        var ubikeArea;
        function initMap() {
            busLayer = new google.maps.Data();
            mrtLayer = new google.maps.Data();
            ubikeLayer = new google.maps.Data();
            busCurveLayer = new google.maps.Data();



            busMap = new google.maps.Map(document.getElementById('busMap'), {
				disableDefaultUI: true,
                center: { lat: state.lat, lng: state.lng },
                zoom: 12
            });

            busCurveMap = new google.maps.Map(document.getElementById('busCurveMap'), {
				disableDefaultUI: true,
                center: { lat: state.lat, lng: state.lng },
                zoom: 12
            });

            mrtMap = new google.maps.Map(document.getElementById('mrtMap'), {
				disableDefaultUI: true,
                center: { lat: state.lat, lng: state.lng },
                zoom: 12
            });

            ubikeMap = new google.maps.Map(document.getElementById('ubikeMap'), {
				disableDefaultUI: true,
                center: { lat: state.lat, lng: state.lng },
                zoom: 12
            });
            var markerB = new google.maps.Marker({
				disableDefaultUI: true,
                position: { lat: state.lat, lng: state.lng },
                map: busMap
            });
            var markerM = new google.maps.Marker({
				disableDefaultUI: true,
                position: { lat: state.lat, lng: state.lng },
                map: mrtMap
            });
            var markerY = new google.maps.Marker({
				disableDefaultUI: true,
                position: { lat: state.lat, lng: state.lng },
                map: ubikeMap
            });
            var markerBusCurve = new google.maps.Marker({
				disableDefaultUI: true,
                position: { lat: state.lat, lng: state.lng },
                map: busCurveMap
            });

            //得到公車捷運youbike服務面積
            $.ajax({
                url: "http://demo.datarget.com.tw/TripTaipei/getTripArea/GeoJson",
                data: {
                    lat: state.lat,
                    lng: state.lng,
                    tripTime: state.tripTime,
                    weekType: state.weekType,
                    startTime: state.startTime,
                    transitType: state.transitType,
                    walkDistance: state.walkDistance,
                },
                dataType: "jsonp",
                jsonpCallback: "callback",//callback回來的fucntion名稱叫做callback  springmvc裡面設定callback名稱
                success: function (response) {
                    if (response.result === '0') {
                        alert("無資料")
                    } else {
                        drawArea(response)
                    }

                },
                error: function (error) {
                    console.error(error);
                }
            });
            //計算彎繞程度
            $.ajax({
                url: "http://demo.datarget.com.tw/TripTaiwan/getBusRouteCurveIndex",
                data: {
                    lat: state.lat,
                    lng: state.lng,
                    // walkDistance: state.walkDistance,
                    walkDistance: 300,
                },
                dataType: "jsonp",
                success: function (response) {
                    drawCurveIndex(response);

                },
                error: function (error) {
                    console.error(error);
                }
            });
            //劃出彎繞公車路線
            $.ajax({
                url: "http://demo.datarget.com.tw/TripTaiwan/getBusRoute",
                data: {
                    lat: state.lat,
                    lng: state.lng,
                    // walkDistance: state.walkDistance,
                        walkDistance: 300,
                },
                dataType: "jsonp",
                success: function (response) {
                    drawBusRoute(response);

                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        function drawBusRoute(data) {
            busCurveLayer.setStyle({
                fillColor: '#00B3FD',
                fillOpacity: 0.9,
                strokeColor: '#00B3FD',
                strokeOpacity: 0.9,
                strokeWeight: 4,
                zIndex: 996
            });
            busCurveLayer.addGeoJson(jQuery.parseJSON(data.result));
            busCurveLayer.setMap(busCurveMap);
        }

        //畫上各運具服務面積
        function drawArea(data) {
            ubikeLayer.setStyle({
                fillColor: '#f39c12',
                fillOpacity: 0.6,
                strokeColor: '#FFFFFF',
                strokeOpacity: 0.8,
                strokeWeight: 1.2,
                zIndex: 996
            });

            mrtLayer.setStyle({
                fillColor: '#1269f3',
                fillOpacity: 0.3,
                strokeColor: '#FFFFFF',
                strokeOpacity: 0.8,
                strokeWeight: 1.2,
                zIndex: 991
            });

            busLayer.setStyle({
                fillColor: '#12f39c',
                fillOpacity: 0.45,
                strokeColor: '#FFFFFF',
                strokeOpacity: 0.8,
                strokeWeight: 1.2,
                zIndex: 995
            });

            if (data.result.B) {
                busLayer.addGeoJson(jQuery.parseJSON(data.result.B));
                busArea = turf.area(jQuery.parseJSON(data.result.B)) / 1000 / 1000
            }
            if (data.result.M) {
                mrtLayer.addGeoJson(jQuery.parseJSON(data.result.M));
                mrtArea = turf.area(jQuery.parseJSON(data.result.M)) / 1000 / 1000
            }
            if (data.result.Y) {
                ubikeLayer.addGeoJson(jQuery.parseJSON(data.result.Y));
                ubikeArea = turf.area(jQuery.parseJSON(data.result.Y)) / 1000 / 1000
            }
            //四捨五入
            busArea = Math.round(busArea * 100) / 100
            mrtArea = Math.round(mrtArea * 100) / 100
            ubikeArea = Math.round(ubikeArea * 100) / 100
            $("#busAreaText").text("服務面積:" + busArea + "平方公里")
            $("#mrtAreaText").text("服務面積:" + mrtArea + "平方公里")
            $("#ubikeAreaText").text("服務面積:" + ubikeArea + "平方公里")
            busLayer.setMap(busMap);
            mrtLayer.setMap(mrtMap);
            ubikeLayer.setMap(ubikeMap);
        }

        function drawCurveIndex(_data) {
            var index = 0;
            var count = 0;
            aaa=_data;
            var data= _data.result;
            for (var i in data) {
                
                if (data[i].index > 1 && data[i].index < 3) {
                    index = parseFloat(data[i].index) + index;
                    count++;
                }
            }
            var totalIndex=Math.round(index/count*1000)/1000;
            console.log("index="+ index)
            console.log("count=" + count)
            $("#busCurveText").text("公車彎繞程度指標:"+ totalIndex);
        }
		
		
		
		
		$(document).ready(function(){
		

			
		});
		
		
		
		
    </script>
	

</body>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCrPV8XZA8_INsW2NicR-2_wxNHW9S4v48&callback=initMap" async defer></script>




</html>